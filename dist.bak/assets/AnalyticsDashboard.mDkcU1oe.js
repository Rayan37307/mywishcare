import{p as n,r as h,j as e,N as p}from"./index.rlwCrqap.js";import{p as o,c as l}from"./pixelConfirmationService.iV45kcXK.js";class g{trackedProducts=new Map;options;constructor(s){this.options={trackViews:!0,trackClicks:!0,trackAddsToCart:!0,trackPurchases:!0,...s}}trackProductView(s,t,a,r){if(!this.options.trackViews)return;const i={product_id:s,product_name:t,product_category:r,product_price:a,currency:"INR",value:a};n.trackProductView(i),this.trackedProducts.set(s,{id:s,name:t,category:r,price:a,currency:"INR",quantity:1,timestamp:Date.now()})}trackProductClick(s,t,a,r){this.options.trackClicks&&n.trackCustomEvent("product_click",{product_id:s,product_name:t,product_category:r,price:a,currency:"INR",timestamp:new Date().toISOString()})}trackAddToCart(s,t,a,r=1,i){if(!this.options.trackAddsToCart)return;const c={product_id:s,product_name:t,product_category:i,product_price:a,currency:"INR",quantity:r,value:a*r};n.trackAddToCart(c)}trackPurchase(s,t,a,r=1,i,c){if(!this.options.trackPurchases)return;const u={value:a*r,currency:"INR",contents:[{id:s,quantity:r,item_price:a}],order_id:i};n.trackPurchase(u),this.trackedProducts.set(s,{id:s,name:t,category:c,price:a,currency:"INR",quantity:r,timestamp:Date.now()})}getTrackedProducts(){return Array.from(this.trackedProducts.values())}getMostViewedProducts(s=10){return this.getTrackedProducts().sort((t,a)=>a.timestamp-t.timestamp).slice(0,s)}getTopPerformingProducts(){return Array.from(this.trackedProducts.keys()).slice(0,5).map(Number)}clearOldData(s=1440*60*1e3){const t=Date.now()-s;this.trackedProducts.forEach((a,r)=>{a.timestamp<t&&this.trackedProducts.delete(r)})}updateOptions(s){this.options={...this.options,...s}}reset(){this.trackedProducts.clear()}}const m=new g;class f{ipBlockList=new Map;orderHistory=[];suspiciousOrders=[];ORDER_RATE_THRESHOLD=5;SAME_INFO_THRESHOLD=10;constructor(){this.loadBlockedIPs(),this.loadOrderHistory()}checkOrderForFraud(s){const t={isSuspicious:!1,confidence:0,reasons:[],shouldBlock:!1};if(this.isIPBlocked(s.ip))return t.isSuspicious=!0,t.confidence=1,t.reasons.push(`IP ${s.ip} is on block list`),t.shouldBlock=!0,t;const a=this.getOrdersFromIP(s.ip);if(a.length>=this.ORDER_RATE_THRESHOLD){const r=a.filter(c=>c.timestamp>Date.now()-36e5),i=this.ORDER_RATE_THRESHOLD*10;r.length>=i?(t.isSuspicious=!0,t.confidence=Math.min(t.confidence+.8,1),t.reasons.push(`High order rate from IP: ${r.length} orders in last hour`),t.shouldBlock=!0):r.length>=this.ORDER_RATE_THRESHOLD&&(t.isSuspicious=!0,t.confidence=Math.min(t.confidence+.3,1),t.reasons.push(`Moderate order rate from IP: ${r.length} orders in last hour (above normal threshold but within mobile threshold)`))}return this.hasSuspiciousPatterns(s)&&(t.isSuspicious=!0,t.confidence=Math.min(t.confidence+.3,1),t.reasons.push("Order contains suspicious patterns")),this.hasDuplicateInfo(s)&&(t.isSuspicious=!0,t.confidence=Math.min(t.confidence+.4,1),t.reasons.push("Order information matches previous suspicious orders")),t.reasons.length>1&&(t.confidence=Math.min(t.confidence+.2,1)),t.confidence>.6&&(t.shouldBlock=!0),t.isSuspicious&&this.suspiciousOrders.push(s),t}blockIP(s,t,a){const r={ip:s,reason:t,timestamp:Date.now(),expiresAt:a};this.ipBlockList.set(s,r),this.saveBlockedIPs()}unblockIP(s){this.ipBlockList.delete(s),this.saveBlockedIPs()}isIPBlocked(s){const t=this.ipBlockList.get(s);return t?t.expiresAt&&Date.now()>t.expiresAt?(this.unblockIP(s),!1):!0:!1}processOrder(s){const t=this.checkOrderForFraud(s);return this.orderHistory.push(s),t.isSuspicious&&t.confidence>.8&&this.blockIP(s.ip,`Suspicious order detected: ${t.reasons.join(", ")}`,Date.now()+1440*60*1e3),t}getBlockedIPs(){return Array.from(this.ipBlockList.values())}getSuspiciousOrders(){return this.suspiciousOrders}resetOrderHistory(){this.orderHistory=[],this.suspiciousOrders=[]}cleanupExpiredBlocks(){const s=Date.now();for(const[t,a]of this.ipBlockList.entries())a.expiresAt&&s>a.expiresAt&&this.ipBlockList.delete(t);this.saveBlockedIPs()}getStatistics(){return{totalOrdersProcessed:this.orderHistory.length,suspiciousOrders:this.suspiciousOrders.length,blockedIPs:this.ipBlockList.size,fakeOrderRate:this.orderHistory.length>0?this.suspiciousOrders.length/this.orderHistory.length:0}}getOrdersFromIP(s){return this.orderHistory.filter(t=>t.ip===s)}hasSuspiciousPatterns(s){return[s.email.includes("temp"),s.email.includes("disposable"),s.email.includes("10minutemail"),s.address1.toLowerCase().includes("fake"),s.name.toLowerCase().includes("test"),s.phone.match(/^(\d)\1{9,}$/)].some(a=>a)}hasDuplicateInfo(s){return this.orderHistory.filter(a=>a.address1===s.address1&&a.state===s.state).length>=this.SAME_INFO_THRESHOLD}loadBlockedIPs(){try{const s=localStorage.getItem("blockedIPs");s&&JSON.parse(s).forEach(a=>{this.ipBlockList.set(a.ip,a)})}catch(s){console.error("Failed to load blocked IPs",s)}}saveBlockedIPs(){try{localStorage.setItem("blockedIPs",JSON.stringify(Array.from(this.ipBlockList.values())))}catch(s){console.error("Failed to save blocked IPs",s)}}loadOrderHistory(){try{const s=localStorage.getItem("orderHistory");s&&(this.orderHistory=JSON.parse(s))}catch(s){console.error("Failed to load order history",s)}}}const x=new f,j=()=>{const[d,s]=h.useState("overview"),t={totalProducts:m.getTrackedProducts().length,mostViewedProducts:m.getMostViewedProducts(5),totalAbandonedCheckouts:l.getAbandonedCheckouts().length,abandonmentStats:l.getAbandonmentStats(),fraudStats:x.getStatistics(),verificationStats:o.getVerificationStats()},a=()=>{};return h.useEffect(()=>{const r=setInterval(()=>{m.clearOldData(),x.cleanupExpiredBlocks(),o.clearOldData()},36e5);return()=>clearInterval(r)},[]),e.jsx("div",{className:"bg-white py-10",children:e.jsxs("div",{className:"container mx-auto max-w-7xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Refresh Data"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-8",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"overview",label:"Overview"},{id:"products",label:"Product Tracking"},{id:"checkouts",label:"Checkout Analysis"},{id:"fraud",label:"Fraud Protection"},{id:"pixels",label:"Pixel Verification"}].map(r=>e.jsx("button",{className:`py-4 px-1 border-b-2 font-medium text-sm ${d===r.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>s(r.id),children:r.label},r.id))})}),e.jsxs("div",{className:"mt-4",children:[d==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Tracked Products"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.totalProducts})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Abandoned Checkouts"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.totalAbandonedCheckouts})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Suspicious Orders"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.fraudStats.suspiciousOrders})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Pixel Confirmations"}),e.jsxs("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:[t.verificationStats.confirmedOrders," / ",t.verificationStats.totalOrders]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg col-span-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Checkout Abandonment Rate"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:t.abandonmentStats.totalAbandoned>0?Math.round(t.abandonmentStats.totalAbandoned/(t.abandonmentStats.totalAbandoned+10)*100)+"%":"0%"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Identified top abandonment points: ",t.abandonmentStats.topAbandonmentPoints.join(", ")]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg col-span-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Fraud Protection Stats"}),e.jsxs("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:[Math.round(t.fraudStats.fakeOrderRate*100)||0,"%"]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[t.fraudStats.blockedIPs," blocked IPs"]})]})]}),d==="products"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Product Tracking"}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Most Viewed Products"}),e.jsx("div",{className:"overflow-x-auto",children:t.mostViewedProducts.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Viewed"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.mostViewedProducts.map((r,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:r.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["৳",r.price]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(r.timestamp).toLocaleString()})]},i))})]}):e.jsx("div",{className:"py-12",children:e.jsx(p,{message:"No most viewed products found",showImage:!1})})})]})]}),d==="checkouts"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Checkout Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Abandonment Statistics"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Abandoned Checkouts:"}),e.jsx("span",{className:"font-medium",children:t.totalAbandonedCheckouts})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Abandonment Rate:"}),e.jsx("span",{className:"font-medium",children:t.abandonmentStats.totalAbandoned>0?Math.round(t.abandonmentStats.totalAbandoned/(t.abandonmentStats.totalAbandoned+10)*100)+"%":"0%"})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Top Abandonment Points:"}),e.jsx("span",{className:"font-medium",children:t.abandonmentStats.topAbandonmentPoints.join(", ")})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Abandoned Checkouts"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.getAbandonedCheckouts().slice(0,5).map((r,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:r.formData.email}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["৳",r.value.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(r.timestamp).toLocaleTimeString()})]},i))})]})})]})]})]}),d==="fraud"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Fraud Protection"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Orders Processed"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.fraudStats.totalOrdersProcessed})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Suspicious Orders"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.fraudStats.suspiciousOrders})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Blocked IPs"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.fraudStats.blockedIPs})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Blocked IPs"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Blocked Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.getBlockedIPs().slice(0,10).map((r,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:r.ip}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.reason}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(r.timestamp).toLocaleDateString()})]},i))})]})})]})]}),d==="pixels"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Pixel Verification"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Total Orders"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.verificationStats.totalOrders})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Verified by Pixel"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:t.verificationStats.confirmedOrders})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Verification Rate"}),e.jsxs("p",{className:"mt-2 text-3xl font-semibold text-gray-900",children:[Math.round(t.verificationStats.confirmationRate*100)||0,"%"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Pixel Confirmations"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Confirmed By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.getConfirmedOrders().slice(0,5).map((r,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:r.orderId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${r.confirmedByPixel?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:r.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.pixelProviders.join(", ")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(r.timestamp).toLocaleTimeString()})]},i))})]})})]})]})]})]})})};export{j as default};
